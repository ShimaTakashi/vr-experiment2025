<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VR Experiment - HDR Stable</title>

  <!-- ❤️ A-Frame 本体 -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ✅ A-Frame 用 HDR sky コンポーネント（three互換整備済み） -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-hdr-environment-component/dist/aframe-hdr-environment-component.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#000;font-family:system-ui;}
    #ui,#next{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,.8);color:#fff;z-index:9999}
    #log{position:fixed;left:10px;bottom:10px;color:#0f0;background:rgba(0,0,0,.6);padding:.4rem .6rem;border-radius:.4rem;font:12px monospace;white-space:pre-wrap;z-index:10000}
    button,input,select{font-size:1.05rem;padding:.6rem .9rem;border-radius:.6rem;}
  </style>
</head>
<body>

<div id="ui">
  <h2>360° HDR 実験</h2>
  <div>被験者ID</div>
  <input id="pid" placeholder="例: S001">
  <div style="margin-top:1rem"><button id="start">開始</button></div>
</div>

<div id="next" style="display:none;">
  <div>フォーム送信後「次へ」</div>
  <button id="nextBtn">次へ</button>
</div>

<div id="log">log:</div>

<!-- ✅ HDR sky を使う A-Frame シーン -->
<a-scene renderer="colorManagement:true; toneMapping:ACESFilmic; toneMappingExposure:1.0">
  <a-entity id="env"
    hdr-environment="path: 1.hdr"></a-entity>
  <a-entity camera look-controls></a-entity>
</a-scene>

<script>
const GOOGLE_FORM_URL =
  "https://docs.google.com/forms/d/e/1FAIpQLSc7bClpct_WSlABMw2oSgxIvqLSIBBuCK_s9rOElQB025EAZw/viewform";

const IMAGES = [
  '1.hdr','8.hdr','15.hdr','22.hdr','29.hdr','36.hdr',
  '43.hdr','50.hdr','57.hdr','64.hdr','71.hdr','78.hdr',
  '85.hdr','92.hdr','99.hdr','106.hdr'
];

const $ = s=>document.querySelector(s);
function log(m){ $('#log').textContent += "\n"+m; console.log(m); }

let idx=0;

function showImage(){
  const src = IMAGES[idx];
  log(`show ${idx+1}/${IMAGES.length}: ${src}`);
  $('#env').setAttribute('hdr-environment', `path: ${src}`);

  // lock 10秒 → フォーム開く
  setTimeout(()=> {
    window.open(GOOGLE_FORM_URL,'_blank');
    $('#next').style.display='flex';
  }, 10000);
}

$('#start').onclick = ()=>{
  $('#ui').style.display='none';
  showImage();
};

$('#nextBtn').onclick = ()=>{
  $('#next').style.display='none';
  idx++;
  if(idx >= IMAGES.length){
    alert("完了しました。おつかれさまです！");
    return;
  }
  showImage();
};

// シーン準備ログ
document.querySelector('a-scene').addEventListener('loaded', ()=> log("scene loaded"));
</script>
</body>
</html>
